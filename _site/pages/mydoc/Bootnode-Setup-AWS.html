<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Prerequisites | POA Network Wiki</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-poa.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="poa-wiki" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> POA Network Wiki</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/poanetwork" target="_blank">GitHub</a></li>
                
                
                
                <li><a href="https://poanet.zendesk.com/hc/en-us" target="_blank">Support Portal</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Prerequisites">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Products</a>
      <ul>
          
          
          
          <li><a href="news.html">News</a></li>
          
          
          
          
          
          
          <li><a href="mydoc_introduction.html">Theme instructions</a></li>
          
          
          
          
          
          
          <li><a href="p1_landing_page.html">Product 1</a></li>
          
          
          
          
          
          
          <li><a href="p2_landing_page.html">Product 2</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Prerequisites</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" href="https://github.com//andogro/poa-wiki/blob/gh-pages/pages//pages/mydoc/Bootnode-Setup-AWS.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    


    

  
<h2 id="prerequisites">Prerequisites</h2>

<h3 id="1-git">1. git</h3>
<ol>
  <li>check that you have git installed
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git --version
</code></pre></div>    </div>
    <p>if not - install it following instructions <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">here</a></p>
  </li>
</ol>

<h3 id="2-python--pip">2. python &amp; pip</h3>
<ol>
  <li>check that you have python 2 version &gt;= 2.6.5 or python 3 version &gt;= 3.3 installed
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python --version
</code></pre></div>    </div>
    <p>if not - install it choosing apropriate binary from <a href="https://www.python.org/downloads/">here</a></p>
  </li>
  <li>check if you have <code class="highlighter-rouge">pip</code> python package manager install
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip --version
</code></pre></div>    </div>
    <p>if not - install it following instructions from <a href="https://pip.pypa.io/en/stable/installing/">here</a>. Basically, you need to download this script and save it on your computer https://bootstrap.pypa.io/get-pip.py then run</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python get-pip.py
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="3-ansible">3. ansible</h3>
<ol>
  <li>follow <a href="http://docs.ansible.com/ansible/latest/intro_installation.html">this guide</a> to install ansible. For example, you can use <code class="highlighter-rouge">pip</code> to do it:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo pip install ansible
</code></pre></div>    </div>
  </li>
  <li>use <code class="highlighter-rouge">pip</code> to install the following packages:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo pip install boto
sudo pip install boto3
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="4-ssh-keys">4. SSH keys</h3>
<ol>
  <li>check if you already have a keypair:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -la ~/.ssh
</code></pre></div>    </div>
    <p>if you get error that directory does not exist or the directory is empty, you need to follow the instructions below. If you already have key pair, you can skip this section.</p>
  </li>
  <li>generate ssh key-pair
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
</code></pre></div>    </div>
    <p>insert your email address there and a strong password. By default, keys will be saved to <code class="highlighter-rouge">~/.ssh/</code> and named <code class="highlighter-rouge">id_rsa</code> with your public key being <code class="highlighter-rouge">~/.ssh/id_rsa.pub</code>.</p>
  </li>
</ol>

<h3 id="5-aws-cli">5. aws cli</h3>
<ol>
  <li>check if you have aws cli installed
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws --version
</code></pre></div>    </div>
    <p>if not - install it following <a href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html">these instructions</a>. The simplest way is to use <code class="highlighter-rouge">pip</code>:</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install awscli --upgrade --user
</code></pre></div>    </div>
    <p>Mac systems with homebrew installed:</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install awscli
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="configuring-aws">Configuring AWS</h2>
<ol>
  <li>
    <p>Register (if you haven’t already) and login to the AWS management console: https://aws.amazon.com/console/</p>
  </li>
  <li>
    <p>to create credentials for cli, open IAM home https://console.aws.amazon.com/iam/home, select “Users” on the left hand side mav bar and then click “Add user”.  Pick a username, and check “Programmatic access” for “Access type”. Click “Next:Permissions”</p>
  </li>
  <li>
    <p>you can choose any of the available options, but “Attach existing policies directly” is the simplest one. In the list of policy types search for and then check “AmazonEC2FullAccess”. Click “Next:Review”.  Review your account and click “Create user” to proceed.</p>
  </li>
  <li>
    <p>it is very important that you copy “Access Key ID” and “Secret Access Key” without leaving this page, because there is no other way to retrieve “Secret Access Key” later and you will have to start again and create another user. After copying this important information, select “Close”.</p>
  </li>
  <li>after you’ve copied and saved your AWS secret keys, the next step is to upload your SSH public key. In the top left corner of the page select “Services -&gt; EC2”. On the left sidebar select “Network &amp; Security” -&gt; “Key Pairs”. Click “Import Key Pair”. Give a name to this keypair, otherwise base name of the file will be used (by default <code class="highlighter-rouge">id_rsa</code>). Browse your filesystem for the public key, or copy/paste:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># if you are on MacOS
pbcopy &lt; ~/.ssh/id_rsa.pub
</code></pre></div>    </div>
    <p>This will copy your public key into your clipboard and can then be pasted.</p>
  </li>
  <li>configure aws cli:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure
</code></pre></div>    </div>
    <p>provide your credentials (Access Key ID and Secret Access Key) from earlier. Choose a region for your account (e.g. <code class="highlighter-rouge">us-east-2</code>) and output format (<code class="highlighter-rouge">json</code> is recommended).</p>
  </li>
  <li>check that keypair was correctly imported:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws ec2 describe-key-pairs
</code></pre></div>    </div>
    <p>you should see your keypair name in the list.</p>
  </li>
</ol>

<h2 id="download-and-configure-playbook">Download and configure playbook</h2>

<p>You may need to add your github info, if you haven’t already.  This may require the creation of a new “Personal Access Token”.</p>

<ol>
  <li>clone repository with ansible playbooks and checkout branch with the network name you want to join (e.g. <code class="highlighter-rouge">core</code> for mainnet and <code class="highlighter-rouge">sokol</code> for testnet)</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/poanetwork/deployment-playbooks.git
cd deployment-playbooks
# for core mainnet
git checkout core
# OR for sokol testnet
git checkout sokol
# check that you ended up on a correct branch (look where the `*` is)
git branch
</code></pre></div></div>

<ol>
  <li>prepare files with ssh keys
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/.ssh/id_rsa.pub &gt; files/admins.pub
cp files/admins.pub files/ssh_bootnode.pub
</code></pre></div>    </div>
  </li>
  <li>create file with configuration settings:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat group_vars/all.network group_vars/bootnode.example &gt; group_vars/all
</code></pre></div>    </div>
  </li>
  <li>to choose subnet run the following command
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws ec2 describe-subnets
</code></pre></div>    </div>
    <p>select any subnet with “State”: “available” and non-zero “AvailableIpAddressCount”. You need to copy/save “SubnetId” of this subnet for later use.</p>
  </li>
  <li>open <code class="highlighter-rouge">group_vars/all</code> and edit the following configuration options:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano group_vars/all
</code></pre></div>    </div>
  </li>
</ol>

<p>Make the following edits:</p>

<ul>
  <li><code class="highlighter-rouge">access_key</code> - your AWS “Access Key ID”</li>
  <li><code class="highlighter-rouge">secret_key</code> - your AWS “Secret Access Key”</li>
  <li><code class="highlighter-rouge">awskeypair_name</code> - name of ssh keypair you uploaded on AWS (by default <code class="highlighter-rouge">id_rsa</code>)</li>
  <li><code class="highlighter-rouge">vpc_subnet_id</code> - insert “SubnetId” that you chose. The next line should look like this:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vpc_subnet_id: "subnet-..."
</code></pre></div>    </div>
  </li>
  <li><code class="highlighter-rouge">NODE_FULLNAME</code> - enter your node’s name (this will be visible to other members of the network). Please consult with Master of Ceremony about naming convention for bootnodes.</li>
  <li><code class="highlighter-rouge">NODE_ADMIN_EMAIL</code> - enter your public email (this will be visible to other members of the network)</li>
  <li><code class="highlighter-rouge">NETSTATS_SERVER</code> - this should be a url provided to you by the Master of Ceremony</li>
  <li><code class="highlighter-rouge">NETSTATS_SECRET</code> - this should be a secret code provided to you by the Master of Ceremony</li>
  <li><code class="highlighter-rouge">allow_bootnode_ssh</code> - leave this value set to <code class="highlighter-rouge">true</code></li>
  <li><code class="highlighter-rouge">allow_bootnode_p2p</code> - set this value to <code class="highlighter-rouge">true</code></li>
  <li><code class="highlighter-rouge">allow_bootnode_rpc</code> - set this value to <code class="highlighter-rouge">false</code></li>
  <li><code class="highlighter-rouge">associate_bootnode_elastic_ip</code> - set this to <code class="highlighter-rouge">false</code>, unless you want to configure AWS Elastic IP for your node</li>
</ul>

<ol>
  <li>examine values in <code class="highlighter-rouge">image</code> and <code class="highlighter-rouge">region</code> properties. If your AWS region doesn’t match the one in <code class="highlighter-rouge">region</code> you need to replace <code class="highlighter-rouge">region</code> with the correct one and select image from this list https://cloud-images.ubuntu.com/locator/ec2/</li>
</ol>

<p>Open this page, scroll down, choose your region from the first (“Zone”) dropdown list, choose <code class="highlighter-rouge">xenial</code> from the second (“Name”) dropdown list and <code class="highlighter-rouge">hvm:ebs-ssd</code> from the fifth (“Instance type”). This should limit you to a single option, copy value from “AMI-ID” column and paste it in <code class="highlighter-rouge">image</code> property.</p>

<ol>
  <li>you may also choose a different value for the <code class="highlighter-rouge">bootnode_instance_type</code>. For <code class="highlighter-rouge">region: "us-east-2"</code> we recommend using <code class="highlighter-rouge">m4.xlarge</code>. Confirm your option of the types of instances available in your region,via: https://aws.amazon.com/ec2/pricing/on-demand/</li>
</ol>

<h2 id="deployment">Deployment</h2>
<h3 id="create-instance">Create instance</h3>
<ol>
  <li>with all options configured, you first need to create an instance: (you should still be in: ~/deployment-playbooks)
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook bootnode.yml
</code></pre></div>    </div>
    <p>this script will ask you for your SSH key passphrase unless you didn’t set a passphrase or you entered it recently.</p>
  </li>
  <li>
    <p>after this process is complete, examine script’s output and write down IP (e.g. <code class="highlighter-rouge">192.0.2.1</code>) address and AWS InstanceID (e.g. <code class="highlighter-rouge">i-0123456789abcdef0</code>) for later use. If you chose to use elastic IP, write down node’s final IP address.</p>
  </li>
  <li>create file <code class="highlighter-rouge">hosts</code> with the server’s ip address (e.g. 192.0.2.1):
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[bootnode]
192.0.2.1
</code></pre></div>    </div>
  </li>
  <li>run ansible playbook
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook -i hosts site.yml
</code></pre></div>    </div>
  </li>
  <li>
    <p>open <code class="highlighter-rouge">NETSTATS_SERVER</code> url in the browser and check that the node named <code class="highlighter-rouge">NODE_FULLNAME</code> appeared in the list</p>
  </li>
  <li>login to the node and get enode from parity logs:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@192.0.2.1
grep enode /home/bootnode/logs/parity.log
</code></pre></div>    </div>
    <p>copy <code class="highlighter-rouge">enode</code> uri and send it to Master of Ceremony. If this line is not found, restart parity</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart poa-parity
</code></pre></div>    </div>
    <p>and try again. If <code class="highlighter-rouge">enode</code> uri is still not found, use the commands below to restart all services.</p>
  </li>
</ol>

<p><em>NOTE</em> if after parity restart you notice that on <code class="highlighter-rouge">NETSTATS_SERVER</code> url your node starts to fall behind other nodes (block number is less than on other nodes), try to restart statistics service (assuming you are connected as <code class="highlighter-rouge">root</code>):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su bootnode
pm2 restart all
</code></pre></div></div>
<p>after that refresh <code class="highlighter-rouge">NETSTATS_SERVER</code> url and check again your node’s block number. If your node is still not active or missing <code class="highlighter-rouge">enode</code>, log in to root account and reboot the OS.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su 
shutdown -r now
</code></pre></div></div>


    <div class="tags">
        
    </div>




</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2018 POA Network. All rights reserved. <br />
 Site last generated: Sep 10, 2018 <br />
<p><img src="images/POA.png" alt="POA Network" width="144" /></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
