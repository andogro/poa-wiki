<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Setting up Non-AWS VM for Bootnode Deployment | POA Network Wiki</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-poa.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="poa-wiki" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> POA Network Wiki</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/poanetwork" target="_blank">GitHub</a></li>
                
                
                
                <li><a href="https://poanet.zendesk.com/hc/en-us" target="_blank">Support Portal</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Setting up Non-AWS VM for Bootnode Deployment">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Products</a>
      <ul>
          
          
          
          <li><a href="news.html">News</a></li>
          
          
          
          
          
          
          <li><a href="mydoc_introduction.html">Theme instructions</a></li>
          
          
          
          
          
          
          <li><a href="p1_landing_page.html">Product 1</a></li>
          
          
          
          
          
          
          <li><a href="p2_landing_page.html">Product 2</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Setting up Non-AWS VM for Bootnode Deployment</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" href="https://github.com//andogro/poa-wiki/blob/gh-pages/pages//pages/mydoc/Bootnode-Setup-Non-AWS.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    


    

  <h2 id="setting-up-non-aws-vm-for-bootnode-deployment">Setting up Non-AWS VM for Bootnode Deployment</h2>

<h4 id="localremote-machine-system-requirements">Local/Remote Machine System Requirements</h4>
<h5 id="remote-machine-minimum-system-requirements">Remote Machine Minimum System Requirements</h5>
<ul>
  <li>Ubuntu 16.04 Image</li>
  <li>Minimum 1 CPU</li>
  <li>Minimum 1GB Memory</li>
  <li>Anything &gt; 4GB will be good, but may need to be upgraded in the future</li>
</ul>

<h5 id="control-machine-dependencies">Control Machine Dependencies</h5>
<ul>
  <li>Linux Based Bash Terminal</li>
  <li>Python 2 (v2.6-v2.7)/Python3 (v3.5+)</li>
  <li>Ansible v2.3+</li>
  <li>Git</li>
</ul>

<h3 id="getting-started">Getting Started</h3>
<p>Log into your Cloud Dashboard and deploy a new node with a minimum of 1 CPU, 1GB (1024Mb) Memory &amp; at least 4GB Hard Drive Capacity (This may need to be upgraded in future). This guide will be using <code class="highlighter-rouge">ubuntu</code> as the username, use the default or replace with your <code class="highlighter-rouge">sudo</code> username.</p>
<ul>
  <li>If prompted to create new user during deployment, do so and skip the section about adding new user.</li>
  <li>If prompted to add SSH Key for your new user, follow the steps below to generate your SSH Key and follow directions how to add to deployment.</li>
</ul>

<h4 id="generating-ssh-key">Generating SSH Key</h4>
<ol>
  <li>
    <p>On your local control machine, open a terminal and generate your SSH key. It is recommended to use a different SSH Key for each POA network, key for <code class="highlighter-rouge">core</code> &amp; key for <code class="highlighter-rouge">sokol</code>. We can set a parameter in ansible inventory script to use the specific key.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh-keygen -t rsa -b 4096 -C "node-label"
</code></pre></div>    </div>

    <p>Enter a <strong>STRONG</strong> password (write it down) and save the key as something memorable, enter complete path to key to save as custom name, replacing <code class="highlighter-rouge">user</code> with your current local user. e.g. below</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> /home/ubuntu/.ssh/id_poa-core
 /home/ubuntu/.ssh/id_poa-sokol
</code></pre></div>    </div>
  </li>
</ol>

<ul>
  <li>This will save 2 files, .pub will be your public key and the other is your private key. Private SSH key stays on your local machine and Public key gets copied to remote machines you want access to.</li>
</ul>

<h4 id="add-user-with-sudo-privileges">Add User with Sudo Privileges</h4>
<ol>
  <li>
    <p>SSH into Remote Node using the root password provided by cloud service (either by web portal or email) or using the SSH key supplied during deployment. If you already have <code class="highlighter-rouge">sudo</code> user, replace <code class="highlighter-rouge">root</code> with your user and skip the next two steps.<br />
 <strong><em>Azure users will not have access to their root account by default, use your sudo user and skip to next section after connecting.</em></strong></p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh root@192.0.2.1
</code></pre></div>    </div>
  </li>
  <li>
    <p>Logged in as <code class="highlighter-rouge">root</code> add user and grant sudo privileges. It is recommended to use default user <code class="highlighter-rouge">ubuntu</code>.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> adduser ubuntu
</code></pre></div>    </div>
  </li>
</ol>

<ul>
  <li>Enter a <strong>STRONG</strong> password to protect the user and you can leave the next 5 fields blank. Confirm the information is correct. We will be using a parameter to ask <code class="highlighter-rouge">sudo</code> pass during ansible deployment.</li>
</ul>

<ol>
  <li>
    <p>Grant user <code class="highlighter-rouge">ubuntu</code> sudo privileges</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> usermod -aG sudo ubuntu
</code></pre></div>    </div>
  </li>
</ol>

<p>Your Non-AWS node is now ready for configuration using ansible-playbook provided by POA. Please follow the directions below to obtain the <code class="highlighter-rouge">deployment-playbooks</code> required to configure network node.</p>

<h3 id="configure-node-with-deployment-playbook">Configure node with Deployment-playbook</h3>
<p>To run playbook you will need a user on the server with <code class="highlighter-rouge">sudo</code> privileges and who can be logged in via SSH public key. By default it is assumed that this user is called <code class="highlighter-rouge">ubuntu</code>. If you already have a user with different name who satisfies these requirements, at the top of <code class="highlighter-rouge">site.yml</code> in <code class="highlighter-rouge">-hosts: all</code> section change line <code class="highlighter-rouge">user: ubuntu</code> to the <code class="highlighter-rouge">sudo</code> user you have</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
- hosts: all
  user: ubuntu
  become: True
...
</code></pre></div></div>
<p><em>NOTE</em>: Playbook will additionally create a new unprivileged user named <code class="highlighter-rouge">bootnode</code> and add your ssh public key to <code class="highlighter-rouge">root</code> account.</p>

<ol>
  <li>Clone repository with ansible playbooks and checkout branch with the network name you want to join (e.g. <code class="highlighter-rouge">core</code> for mainnet and <code class="highlighter-rouge">sokol</code> for testnet)
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/poanetwork/deployment-playbooks.git
cd deployment-playbooks
# for core mainnet
git checkout core
# OR for sokol testnet
git checkout sokol
# check that you ended up on a correct branch (look where the `*` is)
git branch
</code></pre></div>    </div>
  </li>
  <li>two files with ssh public key need to be created for ansible playbook to configure node correctly, use the path to your desired key.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/.ssh/id_poa-core.pub &gt; files/admins.pub
cp files/admins.pub files/ssh_bootnode.pub
</code></pre></div>    </div>
  </li>
  <li>create configuration file
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat group_vars/all.network group_vars/bootnode.example &gt; group_vars/all
</code></pre></div>    </div>
  </li>
  <li>edit the <code class="highlighter-rouge">group_vars/all</code> file and comment out parameters corresponding to aws:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#access_key
#secret_key
#awskeypair_name
#vpc_subnet_id
</code></pre></div>    </div>
  </li>
  <li>set values given to you by Master of Ceremony for the following parameters in <code class="highlighter-rouge">group_vars/all</code>:
    <ul>
      <li><code class="highlighter-rouge">NODE_FULLNAME</code></li>
      <li><code class="highlighter-rouge">NODE_ADMIN_EMAIL</code></li>
      <li><code class="highlighter-rouge">NETSTATS_SERVER</code></li>
      <li><code class="highlighter-rouge">NETSTATS_SECRET</code></li>
    </ul>
  </li>
  <li>set the following options as follows:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>allow_bootnode_ssh: true
allow_bootnode_p2p: true
allow_bootnode_rpc: false
associate_bootnode_elastic_ip: false
</code></pre></div>    </div>
    <p><em>Double check that</em> <code class="highlighter-rouge">allow_bootnode_ssh</code> <em>is</em> <code class="highlighter-rouge">true</code> <em>otherwise you won’t be able to connect to the node</em>.</p>
  </li>
  <li>create file <code class="highlighter-rouge">hosts</code> with the server’s ip address (e.g. 192.0.2.1):
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[bootnode]
192.0.2.1
</code></pre></div>    </div>
  </li>
  <li>run ansible playbook, replace the <code class="highlighter-rouge">--key-file</code> path with your desired SSH key
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook -i hosts site.yml -K --key-file "~/.ssh/id_poa-core"
</code></pre></div>    </div>
  </li>
  <li>
    <p>open <code class="highlighter-rouge">NETSTATS_SERVER</code> url in the browser and check that the node named <code class="highlighter-rouge">NODE_FULLNAME</code> appeared in the list</p>
  </li>
  <li>login to the node and get enode from parity logs:<br />
<em>Without access to <code class="highlighter-rouge">root</code> you can use <code class="highlighter-rouge">sudo</code> user instead, append <code class="highlighter-rouge">sudo</code> in front of commands after connecting to remote machine</em>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@192.0.2.1
grep enode /home/bootnode/logs/parity.log
</code></pre></div>    </div>
    <p>copy <code class="highlighter-rouge">enode</code> uri and send it to Master of Ceremony. If this line is not found, restart parity</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart poa-parity
</code></pre></div>    </div>
    <p>and try again. If <code class="highlighter-rouge">enode</code> uri is still not found, use the commands below to restart all services.</p>
  </li>
</ol>

<p><em>NOTE</em> if after parity restart you notice that on <code class="highlighter-rouge">NETSTATS_SERVER</code> url your node starts to fall behind other nodes (block number is less than on other nodes), try to restart statistics service (assuming you are connected as <code class="highlighter-rouge">root</code>):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su bootnode
pm2 restart all
</code></pre></div></div>
<p>after that refresh <code class="highlighter-rouge">NETSTATS_SERVER</code> url and check your node’s block number. If your node is still not active or missing <code class="highlighter-rouge">enode</code>, log in to root account and reboot.<br />
<em>Without access to <code class="highlighter-rouge">root</code> you can use <code class="highlighter-rouge">sudo</code> user instead, append <code class="highlighter-rouge">sudo</code> in front of commands after connecting to remote machine</em></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su
shutdown -r now
</code></pre></div></div>


    <div class="tags">
        
    </div>




</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2018 POA Network. All rights reserved. <br />
 Site last generated: Sep 10, 2018 <br />
<p><img src="images/POA.png" alt="POA Network" width="144" /></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
